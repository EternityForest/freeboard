var Button=function(e){jsGrid.Field.call(this,e)};function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}Button.prototype=new jsGrid.Field({align:"center",sorter:function(e,t){return 0},itemTemplate:function(e,t){return $("<input>").on("click",function(){this.fn(t)}).title(this.title)},insertTemplate:function(e,t){return""},editTemplate:function(e,t){return $("<input>").on("click",function(){this.fn(t)}).title(this.title)},insertValue:function(){return""},editValue:function(){return""}}),jsGrid.fields.button=Button,function(){var e=0;freeboard.addStyle(".datagrid","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".datagrid-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-datagrid-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-datagrid-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"jsGrid",display_name:"jsGrid Data grid View Plugin",description:"Database grid view. Data is an array of objects.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"backend",display_name:"Data backend. Can be any array, or a freeboard DB controller datasource.",type:"target",default_value:"=[]"},{name:"selection",display_name:"Selection",description:"Selection gets assigned here. If no selection, empty obj.  Set obj.arrival to save changes back to array(The data doesn't matter, it reads as the time when it was set.)",type:"target",default_value:""},{name:"columns",type:"json",display_name:"Columns",schema:{type:"array",items:{type:"object",additionalProperties:!1,properties:{title:{type:"string",required:!0},name:{type:"string",title:"Data column",required:!0},type:{type:"string",title:"Type",required:!0,enum:["control","text","number","checkbox","textarea"]},width:{type:"number",title:"Width(px)",required:!0,default:40}}}},default_value:[{type:"text",title:"Name",name:"name",width:50},{type:"control",title:"",name:"",width:40}]}],newInstance:function(e,n){n(new t(e))}});var t=function(t){if(t.backend&&t.data)throw new Error("Cannot use both the backend and the data options at the same time");var n=this;n.currentSettings=t,n.data=[];var a="datagrid-"+e++,r=$('<div class="datagrid-widget datagrid-label" id="__'+a+'"></div>'),o=$('<h2 class="section-title datagrid-label"></h2>'),d=$("<div>",{id:a}).css("width","90%").css("height","400px"),l="#"+a,s="#value-"+a;n.backend=0,n.makeExternalEditRow=function(e){return new Proxy(e,{set:function(e,t,a){"arrival"==t?(e.arrival=1e3*Date.now(),n.upsert(e),$(l).jsGrid("refresh")):(e.time=1e3*Date.now(),e[t]=a)}})};var u=function(e){e.id=e.id||uuidv4(),e.name=e.name||e.id,e.time=e.time||parseInt(1e3*Date.now()),e.arrival=e.arrival||e.time};n.upsert=function(e){if(e){if(n.backend)return n.backend.insertItem(e);for(i of(void 0!=n.data&&""!=n.data||(n.data=[]),n.data))if(i.id==e.id){if(_.isEqual(i,e))return;return Object.assign(i,e),void n.dataTargets.backend(n.data)}u(e),n.data.push(e),n.dataTargets.backend(n.data)}},n.arrayController={deleteItem:function(e){for(i of(_.isEqual(i.selection,e)&&n.setSelection({}),n.data))i.id==e.id&&(n.data=_.without(n.data,i));n.dataTargets.backend(n.data)},updateItem:n.upsert,insertItem:n.upsert,loadData:function(e){var t=nSQL(n.data||[]).query("select");for(i in e)!e[i]||["sortField","sortOrder","pageIndex","pageSize"].indexOf(i)>-1||(t=t.where(["LOWER("+i+")","=",String(e[i]).toLowerCase()]));e.sortOrder&&(t=t.orderBy([e.sortField+" "+e.sortOrder.toUpperCase()])),t=t.limit(e.pageSize).offset((e.pageIndex-1)*e.pageSize);return async function(){return{data:await t.exec(),itemsCount:n.data.length}}()}},n.setSelection=function(e){n.dataTargets.selection(n.makeExternalEditRow(e))},n.acceptData=function(e){for(f in 0==e&&(e=n.data),n.data=e,n.data)u(f)},n.refreshGrid=function(e){for(f in 0==e&&(e=n.data),n.data=e,n.data)u(f);$(l).jsGrid("destroy");var t=function(){n.dataTargets.backend(n.data)},a=[];for(i of n.currentSettings.columns||[]){var r={};Object.assign(r,i),a.push(r)}var o={width:"95%",height:"250px",inserting:!0,editing:!0,sorting:!0,paging:!0,pageLoading:!0,filtering:!0,rowClick:function(e){n.setSelection(e.item)},controller:n.backend||n.arrayController,fields:a};0==n.backend&&(o.onItemDeleted=t,o.onItemUpdated=t,o.onItemInserted=t),$(l).jsGrid(o),$(l).jsGrid("loadData");try{textFit($(".jsgrid-header-cell:not(.jsgrid-control-field)"))}catch(e){console.log(e)}},$(l).jsGrid("refresh"),o.html(n.currentSettings.title),n.value=n.currentSettings.value||0;n.render=function(e){$(e).append(r),o.appendTo(r),d.appendTo(r),n.refreshGrid(0),$(s).html(n.value+n.currentSettings.unit),$(l).removeClass("ui-widget-content")},n.getHeight=function(){return 6},n.onSettingsChanged=function(e){if(e.backend&&e.data)throw new Error("Cannot use both the backend and the data options at the same time");n.currentSettings=e,o.html(_.isUndefined(e.title)?"":e.title),n.currentSettings.unit=n.currentSettings.unit||"",n.refreshGrid(0),n.setSelection({})},n.onCalculatedValueChanged=function(e,t){"columns"==e&&n.refreshGrid(0),"backend"==e&&("function"==typeof t.loadData?n.backend?(n.backend=t,$(l).jsGrid("loadData")):(n.backend=t,n.refreshGrid(0)):n.backend?(n.backend=0,n.acceptData(t||[]),n.refreshGrid(0)):(n.acceptData(t||[]),$(l).jsGrid("loadData")))},n.onDispose=function(){$(l).jsGrid("destroy")}}}();var htmlWidget=function(e){var t=this;t.id=freeboard.genUUID(),t.fs=0;var n=$('<div style="overflow:auto;height:100%;width:auto;padding:0px;display:flex;flex-direction:column;"></div>'),a=$('<div class="freeboard-hover-unhide" style="border-radius:4px; overflow:hidden;background-color:var(--widget-bg-color);width:100%;padding:3px;margin:0px;position:absolute;user-select: none;opacity:0;"></div>'),i=$("<button></button>").on("click",function(){t.fs?(t.fs=0,document.body.style.setProperty("--box-backdrop",t.backup),n.css({height:"100%",width:"100%",position:"static","z-index":"auto","background-color":"transparent"}),n.css({"background-image":d.background||""}),n.css({"background-repeat":d.backgroundRepeat||""}),n.css({"background-size":d.backgroundSize||""})):(t.fs=1,t.backup=getComputedStyle(document.body).getPropertyValue("--box-backdrop"),document.body.style.setProperty("--box-backdrop","initial"),n.css({height:"100vh",width:"100vw",position:"fixed","z-index":"100",top:"0px",left:"0px","background-color":"var(--box-bg-color)"}),n.css({"background-image":d.background||""}),n.css({"background-repeat":d.backgroundRepeat||""}),n.css({"background-size":d.backgroundSize||""}))}),r=$("<button></button>").on("click",function(){printJS(t.id,"html")});a.append(r),a.append(i);var o=$('<div class="html-widget" style="width:100%; height:auto; margin:0px;padding:0px;flex-grow:100;"></div>').attr("id",t.id),d=e;t.data={},this.updateData=function(){t.data&&"object"==typeof t.data?o.html(Mustache.render(d.html||"",t.data)):o.html(d.html||"")},this.render=function(e){$(e).append(n),n.append(a),a.append(),n.append(o),t.updateData()},this.onSettingsChanged=function(e){d=e,t.updateData(),e.toolbar?a.css({display:"block"}):a.css({display:"none"}),n.css({background:e.background||""}),n.css({"background-repeat":e.backgroundRepeat||""}),n.css({"background-size":e.backgroundSize||""})},this.onCalculatedValueChanged=function(e,n){"html"==e&&t.updateData(),"data"==e&&(t.data=n,t.updateData())},this.onDispose=function(){},this.getHeight=function(){return Number(d.height)},this.onSettingsChanged(e)};function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))}freeboard.loadWidgetPlugin({type_name:"html-template",display_name:"Rich Text Content",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"html-wysywig",description:"HTML template.  You can paste images here, they are stored in the freeboard config itself as base64."},{name:"data",display_name:"Variables to use",type:"calculated",default_value:"={varName: 'value'}",description:"Variables to use in Mustache templating, as a JS object.  Access a var with {{varname}} in your document template, it gets replaced with the value."},{name:"background",display_name:"Background",type:"text",default_value:"transparent",description:"CSS Background(try 'blue' or 'url(--my-image) cover')",options:freeboard.getAvailableCSSImageVars},{name:"backgroundRepeat",display_name:"Background Repeat",type:"option",options:[{name:"no-repeat",value:"no-repeat"},{name:"Tile/Repeat",value:"repeat"}]},{name:"backgroundSize",display_name:"Background Image Size",type:"option",options:[{name:"Cover",value:"cover"},{name:"Contain",value:"contain"},{name:"auto/actual size",value:"auto"}]},{name:"background",display_name:"Background",type:"text",default_value:"transparent",description:"CSS Background(try 'blue' or 'url(--my-image) cover')",options:freeboard.getAvailableCSSImageVars},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"},{name:"toolbar",display_name:"Show toolbar",type:"boolean",default_value:!1,description:"Fullscreen and print options"}],newInstance:function(e,t){t(new htmlWidget(e))}}),function(){var e=0;freeboard.addStyle(".button","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".button-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-button-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-button-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"button_plugin",display_name:"Button",description:"DataTarget compatible button that can run JS code when clicked",fill_size:!0,settings:[{name:"html",display_name:"Button Contents",type:"calculated",default_value:"<i>Button</i>"},{name:"tooltip",display_name:"Tooltip hint",type:"text",default_value:""},{name:"value",display_name:"Value",description:"This value gets pushed to the target when clicked.  If empty, a simple counter is used.  It recalculated every click.",type:"calculated"},{name:"target",display_name:"Data target when clicked",description:'"value" pushed defaults to a click counter',type:"target"},{name:"sound",display_name:"Sound(URL or builtin)",type:"text",default_value:"",options:freeboard.getAvailableSounds},{name:"height",display_name:"Height(px)",type:"number",default_value:30}],newInstance:function(e,n){n(new t(e))}});var t=function(t){var n=this;n.currentSettings=t;var a="button-"+e++,i=$('<div class="button-widget button-label" id="__'+a+'"></div>'),r=$("<button/>",{class:"fullwidth-button",type:"text",pattern:t.pattern,id:a}).html(t.html).css("width","95%").css("height",n.currentSettings.height+"px"),o="#"+a;n.clickCount=0,n.value="",n.render=function(e){$(e).append(i),r.appendTo(i),$(o).attr("title",n.currentSettings.tooltip),$(o).on("click",async function(e){var a=n.clickCount;$(o).attr("disabled",!0).html(t.html+"(waiting)"),await n.processCalculatedSetting("value",!0),n.currentSettings.value&&(a=n.value);try{await n.dataTargets.target(a)}catch(e){freeboard.showDialog(e,"Error in click handler","OK"),freeboard.playSound("error")}_.isUndefined(n.currentSettings.value)||(a=n.value),n.clickCount+=1,$(o).attr("disabled",!1).html(t.html),freeboard.playSound(n.currentSettings.sound),textFit($(o),{alignHoriz:!0,alignVert:!0})}),$(o).removeClass("ui-widget-content")},n.getHeight=function(){return parseInt((n.currentSettings.height+59)/60)},n.onSettingsChanged=function(e){n.currentSettings=e,n.currentSettings.unit=n.currentSettings.unit||"",$(o).attr("tooltip",e.placeholder),$(o).css("height",n.currentSettings.height+"px")},n.onCalculatedValueChanged=function(e,t){"html"==e&&($(o).html(t),textFit($(".fullwidth-button"),{alignHoriz:!0,alignVert:!0})),"value"==e&&(n.value=t)},n.onDispose=function(){}}}(),function(){var e=0;freeboard.addStyle(".colorpicker","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".colorpicker-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-colorpicker-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-colorpicker-range","background: #F90;");freeboard.loadWidgetPlugin({type_name:"colorpicker_plugin",display_name:"Color Picker",description:"Interactive colorpicker Plugin with 2-way data binding. ",fill_size:!0,settings:[{name:"title",display_name:"Title",description:"",type:"calculated"},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When you click OK",value:"change"}]},{name:"format",display_name:"Format",type:"option",options:[{name:"Hex String",value:"hex"},{name:"RGB Object",value:"rgb"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be a value, timestamp pair.",type:"target"}],newInstance:function(e,n){n(new t(e))}});var t=function(t){var n=this;n.currentSettings=t;var a="colorpicker-"+e++,i=$('<div class="colorpicker-widget colorpicker-label" id="__'+a+'"></div>'),r=$("<label></label>",{id:a,name:a}).css({display:"block"}),o=$("<input/>",{id:a,name:a}).css("width","90%"),d="#"+a;n.value="";n.render=function(e){$(e).append(i),r.appendTo(i),o.appendTo(i),o.spectrum({type:"component",showInitial:"true"});var a=function(e){var a=[e.r,e.g,e.b,e.a];if(!_.isEqual(n.value,a)){n.value=a;var i=chroma(e.r,e.g,e.b).alpha(e.a);if("hex"==t.format&&n.dataTargets.target(i.hex()),"rgb"==t.format){var r={_type:"rgb",r:(i=i.rgba())[0],g:i[1],b:i[2],a:i[3]};n.lastDataFromTarget.assign(r),n.dataTargets.target(n.lastDataFromTarget)}}};o.on("change.spectrum",function(e,t){"change"==n.currentSettings.mode&&a(t.toRgb())}),o.on("move.spectrum",function(e,t){"input"==n.currentSettings.mode&&a(t.toRgb())}),$(d).removeClass("ui-widget-content")},n.getHeight=function(){return 1},n.onSettingsChanged=function(e){n.currentSettings=e,n.currentSettings.unit=n.currentSettings.unit||"",$(d).attr("tooltip",e.placeholder)},n.onCalculatedValueChanged=function(e,t){if("target"==e){var a=function(e){return"rgb"==e._type&&(e=chroma(e.r,e.g,e.b,e.a||1).hex()),"hsv"==e._type&&(e=chroma.hsv(e.h,e.s,e.v,e.a||1).hex()),e}(t),i=chroma(a),d=i.rgba();if(_.isEqual(n.value,d))return;n.value=d,n.lastDataFromTarget={},$(o).spectrum("set",i.css())}"title"==e&&$(r).text(t)},n.onDispose=function(){}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"document_database_plugin",display_name:"In-browser database",description:"DB for storing JSON records.  The entire datasource may be used as a controller for the table view. Choose permanent or temp when creating. If you choose wrong, you may need to refresh the page to switch.",settings:[{name:"dbname",display_name:"Database Name",type:"text",default_value:"my_db",required:!0},{name:"perm",display_name:"Permanant",type:"boolean",default_value:!1,description:"If true, data is saved to the user's browser"}],newInstance:async function(t,n,a){var i=new e(t,a);await i.makeDB(),n(i)}});var e=function(e,t){var n=this;n.settings=e;var a="TEMP";e.perm&&(a="PERM"),n.makeDB=async function(){n.db=await nSQL().createDatabase({id:n.settings.dbname,mode:a,tables:[{name:"records",model:{"id:uuid":{pk:!0},"parent:uuid":{},"time:int":{},"arrival:int":{},"type:string":{},"name:string":{},"title:string":{},"body:string":{},"description:string":{}},indexes:{"arrival:int":{},"parent:uuid":{},"time:int":{},"name:string":{search:!0},"type:string":{},"body:string":{search:!0},"title:string":{search:!0}}}],plugins:[FuzzySearch()]})};n.handler={set:function(e,t,n){throw new Error("You can't set anything here. Use getMatching({}) to get all matching records, and set() to set a record.")}},n.makeExternalEditRow=function(e){return new Proxy(e,{set:function(e,t,a){if("id"==t&&a!=e.id)throw new Error("You cannot change a record's ID");"arrival"==t?(e.arrival=1e3*Date.now(),n.upsert(e),n.data.set(e)):(e.time=1e3*Date.now(),e[t]=a)}})},n.data={loadData:async function(e){"Returns a query object for getting the";nSQL().useDatabase(n.settings.dbname);var t=nSQL("records").query("select");for(i in e)e[i]&&"sortField"!=i&&"sortOrder"!=i&&"pageSize"!=i&&"pageIndex"!=i&&"pageLoading"!=i&&(t="body"==i||"name"==i||"title"==i||"description"==i?t.where(["SEARCH("+i.replace("'","")+",'"+e[i].replace("'","")+"')","=",0]):t.where([i,"=",e[i]]));e.sortOrder&&(t=t.orderBy([e.sortField+" "+e.sortOrder.toUpperCase()])),t=t.limit(e.pageSize).offset((e.pageIndex-1)*e.pageSize);try{return{data:await t.exec(),itemsCount:(e.pageIndex+1)*e.pageSize}}catch(e){console.log(e)}},insertItem:async function(e){try{var a={};Object.assign(a,e),a.time=a.time||1e3*Date.now(),a.arrival=a.arrival||a.time,a.id=a.id||freeboard.genUUID(),a.name=a.name||a.id,nSQL().useDatabase(n.settings.dbname),await nSQL("records").query("delete").where(["id","=",a.id]).exec();var i=nSQL("records").query("upsert",[a]).exec();await i,t(n.proxy)}catch(e){throw console.log(e),e}},deleteItem:async function(e){nSQL().useDatabase(n.settings.dbname);var a=nSQL("records").query("delete").where(["id","=",e.id]).exec();return await a,t(n.proxy),a}},n.data.updateItem=n.data.insertItem,n.proxy=new Proxy(n.data,n.handler),n.onSettingsChanged=function(e){e.dbname;e,n.data=freeboard.eval(e.data),t(n.proxy)},n.updateNow=function(){var e;e=n.proxy,t(e)},n.onDispose=function(){}}}(),function(){freeboard.loadDatasourcePlugin({type_name:"JSON",settings:[{name:"url",display_name:"URL",type:"text"},{name:"use_thingproxy",display_name:"Try thingproxy",description:'A direct JSON connection will be tried first, if that fails, a JSONP connection will be tried. If that fails, you can use thingproxy, which can solve many connection problems to APIs. <a href="https://github.com/Freeboard/thingproxy" target="_blank">More information</a>.',type:"boolean",default_value:!0},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5},{name:"method",display_name:"Method",type:"option",options:[{name:"GET",value:"GET"},{name:"POST",value:"POST"},{name:"PUT",value:"PUT"},{name:"DELETE",value:"DELETE"}]},{name:"body",display_name:"Body",type:"text",description:"The body of the request. Normally only used if method is POST"},{name:"headers",display_name:"Headers",type:"array",settings:[{name:"name",display_name:"Name",type:"text"},{name:"value",display_name:"Value",type:"text"}]}],newInstance:function(e,t,n){t(new function(e,t){var n=this,a=null,i=e,r=0,o=!1;function d(e){a&&clearInterval(a),a=setInterval(function(){n.updateNow()},e)}d(1e3*i.refresh),this.updateNow=function(){if(!(r>1&&!i.use_thingproxy||r>2)){var e=i.url;2==r&&i.use_thingproxy&&(e=("https:"==location.protocol?"https:":"http:")+"//thingproxy.freeboard.io/fetch/"+encodeURI(i.url));var a=i.body;if(a)try{a=JSON.parse(a)}catch(e){}$.ajax({url:e,dataType:1==r?"JSONP":"JSON",type:i.method||"GET",data:a,beforeSend:function(e){try{_.each(i.headers,function(t){var n=t.name,a=t.value;_.isUndefined(n)||_.isUndefined(a)||e.setRequestHeader(n,a)})}catch(e){}},success:function(e){o=!0,t(e)},error:function(e,t,a){o||(r++,n.updateNow())}})}},this.onDispose=function(){clearInterval(a),a=null},this.onSettingsChanged=function(e){o=!1,r=0,d(1e3*(i=e).refresh),n.updateNow()}}(e,n))}});freeboard.loadDatasourcePlugin({type_name:"openweathermap",display_name:"Open Weather Map API",settings:[{name:"api_key",display_name:"API Key",type:"text",description:"Your personal API Key from Open Weather Map"},{name:"location",display_name:"Location",type:"text",description:"Example: London, UK"},{name:"units",display_name:"Units",type:"option",default:"imperial",options:[{name:"Imperial",value:"imperial"},{name:"Metric",value:"metric"}]},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5}],newInstance:function(e,t,n){t(new function(e,t){var n=this,a=null,i=e;function r(e){a&&clearInterval(a),a=setInterval(function(){n.updateNow()},e)}r(1e3*i.refresh),this.updateNow=function(){$.ajax({url:"http://api.openweathermap.org/data/2.5/weather?APPID="+i.api_key+"&q="+encodeURIComponent(i.location)+"&units="+i.units,dataType:"JSONP",success:function(e){var n,a={place_name:e.name,sunrise:new Date(1e3*e.sys.sunrise).toLocaleTimeString(),sunset:new Date(1e3*e.sys.sunset).toLocaleTimeString(),conditions:(n=e.weather[0].description,n.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})),current_temp:e.main.temp,high_temp:e.main.temp_max,low_temp:e.main.temp_min,pressure:e.main.pressure,humidity:e.main.humidity,wind_speed:e.wind.speed,wind_direction:e.wind.deg};t(a)},error:function(e,t,n){}})},this.onDispose=function(){clearInterval(a),a=null},this.onSettingsChanged=function(e){i=e,n.updateNow(),r(1e3*i.refresh)}}(e,n))}});freeboard.loadDatasourcePlugin({type_name:"dweet_io",display_name:"Dweet.io",external_scripts:["http://dweet.io/client/dweet.io.min.js"],settings:[{name:"thing_id",display_name:"Thing Name",description:"Example: salty-dog-1",type:"text"}],newInstance:function(e,t,n){t(new function(e,t){var n=e;function a(e){t(e)}this.updateNow=function(){dweetio.get_latest_dweet_for(n.thing_id,function(e,t){e||a(t[0].content)})},this.onDispose=function(){},this.onSettingsChanged=function(e){dweetio.stop_listening_for(n.thing_id),n=e,dweetio.listen_for(n.thing_id,function(e){a(e.content)})},this.onSettingsChanged(e)}(e,n))}});freeboard.loadDatasourcePlugin({type_name:"playback",display_name:"Playback",settings:[{name:"datafile",display_name:"Data File URL",type:"text",description:"A link to a JSON array of data."},{name:"is_jsonp",display_name:"Is JSONP",type:"boolean"},{name:"loop",display_name:"Loop",type:"boolean",description:"Rewind and loop when finished"},{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:5}],newInstance:function(e,t,n){t(new function(e,t){var n,a=this,i=e,r=[],o=0;function d(){r.length>0?(o<r.length&&(t(r[o]),o++),o>=r.length&&i.loop&&(o=0),o<r.length&&(n=setTimeout(d,1e3*i.refresh))):t({})}function l(){r=[],o=0,n&&(clearTimeout(n),n=null)}this.updateNow=function(){l(),$.ajax({url:i.datafile,dataType:i.is_jsonp?"JSONP":"JSON",success:function(e){r=_.isArray(e)?e:[],o=0,d()},error:function(e,t,n){}})},this.onDispose=function(){l()},this.onSettingsChanged=function(e){i=e,a.updateNow()}}(e,n))}});freeboard.loadDatasourcePlugin({type_name:"clock",display_name:"Clock",settings:[{name:"refresh",display_name:"Refresh Every",type:"number",suffix:"seconds",default_value:1},{name:"strftime",display_name:"Strftime String for custom_value",type:"text",suffix:"seconds",default_value:"%I:%M:%S %p %b %d %Y"}],newInstance:function(e,t,n){t(new function(e,t){var n,a=this,i=e;function r(){n&&(clearTimeout(n),n=null)}function o(){r(),n=setInterval(a.updateNow,1e3*i.refresh)}this.updateNow=function(){var e=new Date,n="";i.strftime&&(n=strftime(i.strftime,e));var a={numeric_value:e.getTime(),custom_value:n,full_string_value:e.toLocaleString(),date_string_value:e.toLocaleDateString(),time_string_value:e.toLocaleTimeString(),date_object:e};t(a)},this.onDispose=function(){r()},this.onSettingsChanged=function(e){i=e,o()},o()}(e,n))}}),freeboard.loadDatasourcePlugin({type_name:"meshblu",display_name:"Octoblu",description:"app.octoblu.com",external_scripts:["http://meshblu.octoblu.com/js/meshblu.js"],settings:[{name:"uuid",display_name:"UUID",type:"text",default_value:"device uuid",description:"your device UUID",required:!0},{name:"token",display_name:"Token",type:"text",default_value:"device token",description:"your device TOKEN",required:!0},{name:"server",display_name:"Server",type:"text",default_value:"meshblu.octoblu.com",description:"your server",required:!0},{name:"port",display_name:"Port",type:"number",default_value:80,description:"server port",required:!0}],newInstance:function(t,n,a){n(new e(t,a))}});var e=function(e,t){var n=e;this.onSettingsChanged=function(e){n=e},this.updateNow=function(){var e;(e=skynet.createConnection({uuid:n.uuid,token:n.token,server:n.server,port:n.port})).on("ready",function(n){e.on("message",function(e){t(e)})})},this.onDispose=function(){}}}(),function(){var e=100,t=["#FF9900","#FFFFFF","#B3B4B4","#6B6B6B","#28DE28","#13F7F9","#E6EE18","#C41204","#CA3CB8","#0B1CFB"];function n(n,a,i){var r=$(n).data().values,o=$(n).data().valueMin,d=$(n).data().valueMax;r||(r=[],o=void 0,d=void 0);var l=function(t,n){r[n]||(r[n]=[]),r[n].length>=e&&r[n].shift(),r[n].push(Number(t)),(void 0===o||t<o)&&(o=t),(void 0===d||t>d)&&(d=t)};_.isArray(a)?_.each(a,l):l(a,0),$(n).data().values=r,$(n).data().valueMin=o,$(n).data().valueMax=d;var s='<span style="color: {{color}}">&#9679;</span> {{y}}',u=!1;_.each(r,function(e,a){$(n).sparkline(e,{type:"line",composite:u,height:"100%",width:"100%",fillColor:!1,lineColor:t[a%t.length],lineWidth:2,spotRadius:3,spotColor:!1,minSpotColor:"#78AB49",maxSpotColor:"#78AB49",highlightSpotColor:"#9D3926",highlightLineColor:"#9D3926",chartRangeMin:o,chartRangeMax:d,tooltipFormat:i&&i[a]?s+" ("+i[a]+")":s}),u=!0})}var a=freeboard.getStyleString("values");freeboard.addStyle(".widget-big-text",a+"font-size:75px;"),freeboard.addStyle(".tw-display","width: 100%; height:100%; display:table; table-layout:fixed;"),freeboard.addStyle(".tw-tr","display:table-row;"),freeboard.addStyle(".tw-tg","display:table-row-group;"),freeboard.addStyle(".tw-tc","display:table-caption;"),freeboard.addStyle(".tw-td","display:table-cell;"),freeboard.addStyle(".tw-value",a+"overflow: hidden;display: inline-block;text-overflow: ellipsis;"),freeboard.addStyle(".tw-unit","display: inline-block;padding-left: 10px;padding-bottom: 1.1em;vertical-align: bottom;"),freeboard.addStyle(".tw-value-wrapper","position: relative;vertical-align: middle;height:100%;"),freeboard.addStyle(".tw-sparkline","height:20px;");var i=function(e){var t=e,a=$('<div class="tw-display"></div>'),i=$('<h2 class="section-title tw-title tw-td"></h2>'),r=$('<div class="tw-value"></div>'),o=$('<div class="tw-unit"></div>'),d=$('<div class="tw-sparkline tw-td"></div>');function l(){_.isUndefined(t.units)||""==t.units?r.css("max-width","100%"):r.css("max-width",a.innerWidth()-o.outerWidth(!0)+"px")}this.render=function(e){$(e).empty(),$(a).append($('<div class="tw-tr"></div>').append(i)).append($('<div class="tw-tr"></div>').append($('<div class="tw-value-wrapper tw-td"></div>').append(r).append(o))).append($('<div class="tw-tr"></div>').append(d)),$(e).append(a),l()},this.onSettingsChanged=function(e){t=e;var n=!_.isUndefined(e.title)&&""!=e.title,a=!_.isUndefined(e.units)&&""!=e.units;e.sparkline?d.attr("style",null):(delete d.data().values,d.empty(),d.hide()),n?(i.html(_.isUndefined(e.title)?"":e.title),i.attr("style",null)):(i.empty(),i.hide()),a?(o.html(_.isUndefined(e.units)?"":e.units),o.attr("style",null)):(o.empty(),o.hide()),"big"==e.size?valueFontSize="60px":"regular"==e.size?valueFontSize="30px":valueFontSize=e.size,r.css({"font-size":valueFontSize}),l()},this.onSizeChanged=function(){l()},this.onCalculatedValueChanged=function(e,a){"value"==e&&(t.animate?function(e,t,n){var a=$(t).text();if(a!=e)if($.isNumeric(e)&&$.isNumeric(a)){var i=e.toString().split("."),r=0;i.length>1&&(r=i[1].length);var o=0;(i=a.toString().split(".")).length>1&&(o=i[1].length),jQuery({transitionValue:Number(a),precisionValue:o}).animate({transitionValue:Number(e),precisionValue:r},{duration:n,step:function(){$(t).text(this.transitionValue.toFixed(this.precisionValue))},done:function(){$(t).text(e)}})}else $(t).text(e)}(a,r,500):r.text(a),t.sparkline&&n(d,a))},this.onDispose=function(){},this.getHeight=function(){return"big"==t.size||t.sparkline?2:1},this.onSettingsChanged(e)};freeboard.loadWidgetPlugin({type_name:"text_widget",display_name:"Text",settings:[{name:"title",display_name:"Title",type:"text"},{name:"size",display_name:"Size",type:"option",options:[{name:"Regular",value:"regular"},{name:"Big",value:"big"},{name:"Small",value:"small"},{name:"Medium",value:"Medium"},{name:"Large",value:"large"},{name:"Extra Large",value:"x-large"},{name:"32px",value:"32px"},{name:"48px",value:"48px"},{name:"64px",value:"64px"}]},{name:"value",display_name:"Value",type:"calculated"},{name:"sparkline",display_name:"Include Sparkline",type:"boolean"},{name:"animate",display_name:"Animate Value Changes",type:"boolean",default_value:!0},{name:"units",display_name:"Units",type:"text",options:function(){return{lbs:"",kgs:"",psi:"",meters:"",feet:"",mm:"",degC:"",degF:""}}},{name:"font",display_name:"Font",type:"text",options:function(){return{FBMono:"",FBSans:"",DSEG7:"",DSEG14:"",Pandora:"",FBCursive:"",FBSerif:"",DIN:"",FBComic:"",QTBlackForest:"",PenguinAttack:"",Chancery:"",Pixel:"",Handwriting:"",Chalkboard:"",RoughScript:""}}}],newInstance:function(e,t){t(new i(e))}});var r=0;freeboard.addStyle(".gauge-widget-wrapper","width: 100%;text-align: center;");freeboard.loadWidgetPlugin({type_name:"gauge",display_name:"Gauge",settings:[{name:"title",display_name:"Title",type:"text"},{name:"heading",display_name:"Heading",type:"text"},{name:"style",type:"json",display_name:"Theming",schema:{type:"object",title:"Theme",properties:{pointerColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerTipColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleInner:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleInnerEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleOuter:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerCircleOuterEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerShadowBottom:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},pointerShadowTop:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},fgColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderInner:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderInnerEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderMiddle:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderMiddleEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderOuter:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderOuterEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}}},borderInnerWidth:{type:"number",min:0,max:12},borderMiddleWidth:{type:"number",min:0,max:12},borderOuterWidth:{type:"number",min:0,max:12},size:{type:"number",min:1,max:8},borderShadow:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb",alpha:!0}}},plateColor:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}},default_value:"rgb(0,0,0)"},plateColorEnd:{type:"string",format:"color",options:{colorpicker:{editorFormat:"rgb"}},default_value:"rgb(0,0,0)"},fontTitleSize:{type:"number",min:8,max:64},fontValueSize:{type:"number",min:8,max:64}}},default_value:{pointerCircleInner:"rgb(57,43,21)",pointerCircleInnerEnd:"rgb(57,43,21)",pointerCircleOuter:"rgb(87,63,41)",pointerCircleOuterEnd:"rgb(57,43,21)",pointerShadowTop:"#000000",pointerShadowBottom:"#000000",pointerColor:"#000000",pointerTipColor:"#002000",fgColor:"rgb(57,43,21)",borderInner:"rgb(77,68,56)",borderInnerEnd:"rgb(59,44,36)",borderMiddle:"rgb(202,192,155)",borderMiddleEnd:"rgb(163,145,96)",borderOuter:"rgb(102,90,67)",borderOuterEnd:"rgb(57,41,34)",borderInnerWidth:2,borderMiddleWidth:3,borderOuterWidth:2,borderShadow:"#000000",plateColor:"rgb(204,198,190)",plateColorEnd:"rgb(195,190,180)",fontTitleSize:32,fontValueSize:40,size:4}},{name:"value",display_name:"Value",type:"calculated"},{name:"units",display_name:"Units",type:"text"},{name:"min_value",display_name:"Minimum",type:"text",default_value:0},{name:"max_value",display_name:"Maximum",type:"text",default_value:100},{name:"tick_interval",display_name:"Tick Spacing",type:"text",default_value:10},{name:"minor_ticks",display_name:"Tick divisions",type:"text",default_value:5},{name:"digits",display_name:"Show digits",type:"number",default_value:4}],newInstance:function(e,t){t(new function(e){var t,n=this,a="gauge-"+r++,i=$('<h2 class="section-title"></h2>'),o=$('<canvas width=180 height=180 id="'+a+'"></canvas>'),d=!1;function l(){if(d){o.empty(),t&&t.destroy();var i=parseInt(getComputedStyle(document.documentElement).getPropertyValue("--title-line-height"))+10;o.attr("width",60*parseInt(e.style.size)-i).attr("height",60*parseInt(e.style.size)-i);for(var r=document.getElementById(a),l=String(n.currentSettings.max_value||100).split(".")[0].length,s={renderTo:r,width:60*Number(e.style.size)-i,height:60*Number(e.style.size)-i,units:n.currentSettings.units,title:n.currentSettings.title,value:n.value,minValue:n.currentSettings.min_value,maxValue:n.currentSettings.max_value,majorTicks:[],minorTicks:n.currentSettings.minorTicks,strokeTicks:!1,highlights:[],colorBorderOuter:n.currentSettings.style.borderOuter,colorBorderOuterEnd:n.currentSettings.style.borderOuterEnd,colorBorderMiddle:n.currentSettings.style.borderMiddle,colorBorderMiddleEnd:n.currentSettings.style.borderMiddleEnd,colorBorderInner:n.currentSettings.style.borderInner,colorBorderInnerEnd:n.currentSettings.style.borderInnerEnd,borderInnerWidth:n.currentSettings.style.borderInnerWidth,borderMiddleWidth:n.currentSettings.style.borderMiddleWidth,borderOuterWidth:n.currentSettings.style.borderOuterWidth,colorBorderShadow:n.currentSettings.style.borderShadow,colorPlate:n.currentSettings.style.plateColor,colorPlateEnd:n.currentSettings.style.plateColorEnd,colorMajorTicks:n.currentSettings.style.fgColor,colorMinorTicks:n.currentSettings.style.fgColor,colorTitle:n.currentSettings.style.fgColor,colorUnits:n.currentSettings.style.fgColor,colorNumbers:n.currentSettings.style.fgColor,colorNeedle:n.currentSettings.style.pointerColor,colorNeedleShadowUp:n.currentSettings.style.pointerShadowTop,colorNeedleShadowBottom:n.currentSettings.style.pointerShadowBottom,colorNeedleEnd:n.currentSettings.style.pointerTipColor,colorNeedleCircleOuter:n.currentSettings.style.pointerCircleOuter,colorNeedleCircleOuterEnd:n.currentSettings.style.pointerCircleOuterEnd,colorNeedleCircleInner:n.currentSettings.style.pointerCircleInner,colorNeedleCircleInnerEnd:n.currentSettings.style.pointerCircleInnerEnd,fontTitleSize:n.currentSettings.style.fontTitleSize,fontUnitsSize:n.currentSettings.style.fontTitleSize,fontValueSize:n.currentSettings.style.fontValueSize,valueBox:n.currentSettings.digits>0,valueInt:l,valueDec:Math.max(n.currentSettings.digits-l,0),animationRule:"bounce",animationDuration:500,animation:!1},u=parseInt(n.currentSettings.min_value);u<=parseInt(n.currentSettings.max_value);)s.majorTicks.push(String(u)),u+=parseInt(n.currentSettings.tick_interval);var c=new RadialGauge(s);c.draw(),t=c}}n.value=0,n.currentSettings=e,e.style=e.style||{},this.render=function(e){d=!0,$(e).append(i).append($('<div class="gauge-widget-wrapper"></div>').append(o)),l()},this.onSettingsChanged=function(e){n.currentSettings=e,l(),i.html(e.heading||"")},this.onCalculatedValueChanged=function(e,a){n.value=a,_.isUndefined(t)||(t.value=Number(a),o.attr("title",String(a)+(n.currentSettings.units||"")))},this.onDispose=function(){t&&t.destroy()},this.getHeight=function(){try{return n.currentSettings.style.size}catch(e){return console.log(e),3}},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".sparkline","width:100%;height: 75px;");var o=function(e){var a=$('<h2 class="section-title"></h2>'),i=$('<div class="sparkline"></div>'),r=$("<div></div>"),o=e;this.render=function(e){$(e).append(a).append(i).append(r)},this.onSettingsChanged=function(e){o=e,a.html(_.isUndefined(e.title)?"":e.title),e.include_legend&&function(e,n){for(var a=$("<div class='sparkline-legend'></div>"),i=0;i<n.length;i++){var r=t[i%t.length],o=n[i];a.append("<div class='sparkline-legend-value'><span style='color:"+r+"'>&#9679;</span>"+o+"</div>")}e.empty().append(a),freeboard.addStyle(".sparkline-legend","margin:5px;"),freeboard.addStyle(".sparkline-legend-value","color:white; font:10px arial,san serif; float:left; overflow:hidden; width:50%;"),freeboard.addStyle(".sparkline-legend-value span","font-weight:bold; padding-right:5px;")}(r,e.legend.split(","))},this.onCalculatedValueChanged=function(e,t){o.legend?n(i,t,o.legend.split(",")):n(i,t)},this.onDispose=function(){},this.getHeight=function(){var e=0;if(o.include_legend&&o.legend){var t=o.legend.split(",").length;t>4?e=.5*Math.floor((t-1)/4):t&&(e=.5)}return 2+e},this.onSettingsChanged(e)};freeboard.loadWidgetPlugin({type_name:"sparkline",display_name:"Sparkline",settings:[{name:"title",display_name:"Title",type:"text"},{name:"value",display_name:"Value",type:"calculated",multi_input:"true"},{name:"include_legend",display_name:"Include Legend",type:"boolean"},{name:"legend",display_name:"Legend",type:"text",description:"Comma-separated for multiple sparklines"}],newInstance:function(e,t){t(new o(e))}}),freeboard.addStyle("div.pointer-value","position:absolute;height:95px;margin: auto;top: 0px;bottom: 0px;width: 100%;text-align:center;");freeboard.loadWidgetPlugin({type_name:"pointer",display_name:"Pointer",settings:[{name:"direction",display_name:"Direction",type:"calculated",description:"In degrees"},{name:"value_text",display_name:"Value Text",type:"calculated"},{name:"units",display_name:"Units",type:"text"}],newInstance:function(e,t){t(new function(e){var t,n,a,i,r=$('<div class="widget-big-text"></div>'),o=$("<div></div>");this.render=function(e){a=$(e).width(),i=$(e).height();var d=Math.min(a,i)/2-6,l=(t=Raphael($(e).get()[0],a,i)).circle(a/2,i/2,d);l.attr("stroke","#FF9900"),l.attr("stroke-width",3),(n=t.path(function(e){if(!e||e.length<2)return[];var t=[];t.push(["m",e[0],e[1]]);for(var n=2;n<e.length;n+=2)t.push(["l",e[n],e[n+1]]);return t.push(["z"]),t}([a/2,i/2-d+3,15,20,-30,0]))).attr("stroke-width",0),n.attr("fill","#fff"),$(e).append($('<div class="pointer-value"></div>').append(r).append(o))},this.onSettingsChanged=function(e){o.html(e.units)},this.onCalculatedValueChanged=function(e,t){"direction"==e?_.isUndefined(n)||n.animate({transform:"r"+t+","+a/2+","+i/2},250,"bounce"):"value_text"==e&&r.html(t)},this.onDispose=function(){},this.getHeight=function(){return 4},this.onSettingsChanged(e)}(e))}});freeboard.loadWidgetPlugin({type_name:"picture",display_name:"Picture",fill_size:!0,settings:[{name:"src",display_name:"Image URL",type:"calculated"},{type:"number",display_name:"Refresh every",name:"refresh",suffix:"seconds",description:"Leave blank if the image doesn't need to be refreshed"}],newInstance:function(e,t){t(new function(e){var t,n,a;function i(){n&&(clearInterval(n),n=null)}function r(){if(t&&a){var e=a;$(t).css({"background-image":"url("+e+")"})}}this.render=function(e){$(e).css({width:"100%",height:"100%","background-size":"cover","background-position":"center"}),t=e},this.onSettingsChanged=function(e){i(),e.refresh&&e.refresh>0&&(n=setInterval(r,1e3*Number(e.refresh)))},this.onCalculatedValueChanged=function(e,t){"src"==e&&(a=t),r()},this.onDispose=function(){i()},this.getHeight=function(){return 4},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".indicator-light","border-radius:50%;width:22px;height:22px;border:2px solid #3d3d3d;margin-top:5px;float:left;background-color:#222;margin-right:10px;"),freeboard.addStyle(".indicator-light.on","background-color:#FFC773;box-shadow: 0px 0px 15px #FF9900;border-color:#FDF1DF;"),freeboard.addStyle(".indicator-text","margin-top:10px;");freeboard.loadWidgetPlugin({type_name:"indicator",display_name:"Indicator Light",settings:[{name:"title",display_name:"Title",type:"text"},{name:"value",display_name:"Value",type:"calculated"},{name:"on_text",display_name:"On Text",type:"calculated"},{name:"off_text",display_name:"Off Text",type:"calculated"}],newInstance:function(e,t){t(new function(e){var t,n,a=$('<h2 class="section-title"></h2>'),i=$('<div class="indicator-text"></div>'),r=$('<div class="indicator-light"></div>'),o=e,d=!1;function l(){r.toggleClass("on",d),d?i.text(_.isUndefined(t)?_.isUndefined(o.on_text)?"":o.on_text:t):i.text(_.isUndefined(n)?_.isUndefined(o.off_text)?"":o.off_text:n)}this.render=function(e){$(e).append(a).append(r).append(i)},this.onSettingsChanged=function(e){o=e,a.html(_.isUndefined(e.title)?"":e.title),l()},this.onCalculatedValueChanged=function(e,a){"value"==e&&(d=Boolean(a)),"on_text"==e&&(t=a),"off_text"==e&&(n=a),l()},this.onDispose=function(){},this.getHeight=function(){return 1},this.onSettingsChanged(e)}(e))}}),freeboard.addStyle(".gm-style-cc a","text-shadow:none;"),freeboard.addStyle(".html-widget","white-space:normal;width:100%;height:100%");freeboard.loadWidgetPlugin({type_name:"html",display_name:"Show computed HTML",fill_size:!0,settings:[{name:"html",display_name:"HTML",type:"calculated",description:"Can be literal HTML, or javascript that outputs HTML."},{name:"height",display_name:"Height Blocks",type:"number",default_value:4,description:"A height block is around 60 pixels"}],newInstance:function(e,t){t(new function(e){var t=$('<div class="html-widget"></div>'),n=e;this.render=function(e){$(e).append(t)},this.onSettingsChanged=function(e){n=e},this.onCalculatedValueChanged=function(e,n){"html"==e&&t.html(n)},this.onDispose=function(){},this.getHeight=function(){return Number(n.height)},this.onSettingsChanged(e)}(e))}})}(),function(){freeboard.loadDatasourcePlugin({type_name:"core_scratchpad_plugin",display_name:"Scratchpad Variables",description:"The data is just an empty space.  To set some data, use datasources['scratchpad']['SomeName'] as a data target.  It will be available to read in other widgets.  You can also set the default data using JSON.",settings:[{name:"data",display_name:"Default Data(as JSON or JS expression)",type:"calculated",default_value:"={}",options:function(){return{"={key: 'value'}":""}},description:"Must be a valid JS =expression that returns an object. Whatever it returns will be the default data.",required:!0},{name:"persist",display_name:"Persistance Mode",type:"option",default_value:"off",options:[{name:"Off",value:"off"},{name:"Board",value:"board"}],description:"off: no persistance,  board: changes are passed to the Default Data field and can be exported with the board.",required:!0},{name:"lock",display_name:"Lock data(read only)",type:"boolean",default_value:!1},{name:"",display_name:"",html:"Show current data",type:"button",onclick:function(e,t){freeboard.showDialog(JSON.stringify(t.data),"Debug data for: "+e+" (non-JSON not shown)","OK")},description:""},{name:"",display_name:"",html:"Show current data in JSON editor",type:"button",description:"",onclick:function(e,t){var n=[];freeboard.showDialog($('<div id="fb-global-json-editor">'),"Debug data for: "+e+" (non-JSON not shown)","OK","Cancel",function(){Object.assign(t.proxy,n[0].getValue()),n[0].destroy()},function(){n[0].destroy()});var a=new JSONEditor(document.getElementById("fb-global-json-editor"),{schema:{}});n.push(a),a.setValue(t.data)}}],newInstance:function(t,n,a){n(new e(t,a))}});var e=function(e,t){var n=this,a=e;n.handler={set:function(e,i,r){if(a.lock)throw new Error("Cannot change this. It is locked in the datasource settings");return e[i]=r,t(n.proxy),"board"==a.persist&&(a.data="="+JSON.stringify(e),freeboard.setDatasourceSettings(a.name,e)),!0}},n.data={},n.proxy=new Proxy(n.data,n.handler),n.onSettingsChanged=function(e){a=e,t(n.proxy)},n.onCalculatedSettingChanged=function(e,a){"data"==e&&(n.data=a,n.proxy=new Proxy(n.data,n.handler),t(n.proxy))},n.updateNow=function(){var e;e=n.proxy,t(e)},n.onDispose=function(){}}}(),function(){var e=0;freeboard.addStyle(".slider","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".slider-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-slider-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-slider-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"slider_plugin",display_name:"Slider",description:"Interactive Slider Plugin with 2-way data binding.  Value is a list of 2 items, the value and the timestamp.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text"},{name:"unit",display_name:"Unit of measure",type:"text"},{name:"min",display_name:"Min",type:"calculated",default_value:"0"},{name:"max",display_name:"Max",type:"calculated",default_value:"100"},{name:"step",display_name:"Step",type:"calculated",default_value:"1"},{name:"default",display_name:"Default Value",type:"calculated",default_value:"0"},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When Released",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be a value, timestamp pair.",type:"target"}],newInstance:function(e,n){n(new t(e))}});var t=function(t){var n=this;currentSettings=t,currentSettings.unit=currentSettings.unit||"";var a="slider-"+e++,i=$('<div class="slider-widget slider-label" id="__'+a+'"></div>'),r=$('<h2 class="section-title slider-label"></h2>'),o=$('<div id="value-'+a+'" style="display:inline-block; padding-left: 10px; font-weight:bold; color: #d3d4d4" ></div>'),d=$("<input/>",{type:"range",id:a}),l="#"+a,s="#value-"+a;_.isUndefined(currentSettings.value)||currentSettings.value;r.html(_.isUndefined(currentSettings.title)?"":currentSettings.title),n.min=_.isUndefined(currentSettings.min)?0:currentSettings.min,n.max=_.isUndefined(currentSettings.max)?100:currentSettings.max,n.step=_.isUndefined(currentSettings.step)?100:currentSettings.step,n.value=void 0;n.render=function(e){$(e).append(i),r.appendTo(i),$(r).append(o),d.appendTo(i),$(l).attr("min",n.min),$(l).attr("max",n.max),$(l).attr("step",n.step),$(l).css("width","95%"),$(l).on("input",function(e){$("#value-"+a).html(e.value)}),$(s).html((n.value||0)+currentSettings.unit),$(l).on("change",function(e){n.dataTargets.target(parseFloat(e.target.value))}),$(l).on("input",function(e){n.value=e.target.value,$(s).html(e.target.value+currentSettings.unit),"change"!=currentSettings.mode&&n.dataTargets.target(parseFloat(e.target.value))}),$(l).removeClass("ui-widget-content")},n.getHeight=function(){return"big"==currentSettings.size?2:1},n.onSettingsChanged=function(e){currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),$(r).append(o),currentSettings.unit=currentSettings.unit||"",$(s).html((n.value||0)+currentSettings.unit)},n.onCalculatedValueChanged=function(e,t){if("target"==e){n.value=t;var a=t;$(o).html(a+currentSettings.unit),a!=$(l).val()&&$(l).val(a)}if("default"==e&&_.isUndefined(n.value)){t=parseFloat(t),n.dataTargets.target(t),n.value=t;a=t;$(o).html(a+currentSettings.unit),a!=$(l).val()&&$(l).val(a)}"step"==e&&(n.step=t,$(l).attr("step",n.step)),"max"==e&&(t>n.min?(n.max=t,$(l).attr("max",t)):(currentSettings.max=n.max,freeboard.showDialog($("<div align='center'> Max value cannot be lower than Min value!</div>"),"Warning!","OK",null,function(){}))),"min"==e&&(t<n.max?(n.min=t,$(l).attr("min",t)):(currentSettings.min=n.min,freeboard.showDialog($("<div align='center'> Min value cannot be greater than Max value!</div>"),"Warning!","OK",null,function(){})))},n.onDispose=function(){}}}(),function(){var e=0;freeboard.loadWidgetPlugin({type_name:"switch_plugin",display_name:"Switch",description:"Interactive on-off switch",settings:[{name:"title",display_name:"Title",type:"text"},{name:"target",display_name:"Data Target",type:"target",description:"Bind state to this datasource"},{name:"default",display_name:"Default",type:"calculated"},{name:"on_text",display_name:"On Text",type:"text",default_value:"On"},{name:"off_text",display_name:"Off Text",type:"text",default_value:"Off"},{name:"sound",display_name:"Sound(URL or builtin)",type:"text",default_value:"",options:freeboard.getAvailableSounds}],newInstance:function(e,n){n(new t(e))}}),freeboard.addStyle(".floating-box","display: inline-block; vertical-align: top; width: 78px; background-color: #222;margin-top: 10px; margin-right: 5px;"),freeboard.addStyle(".round","border-radius: 50%;");var t=function(t){var n=this,a="onoffswitch-"+e++,i=t,r=$('<div class="floating-box"></div>'),o=$('<div class="floating-box onoffswitch-title">'+t.title+"</div>"),d=$('<div class="onoffswitch"><label class="onoffswitch-label" for="'+a+'"><div class="onoffswitch-inner"><span class="on"></span><span class="off"></span></div><div class="onoffswitch-switch round"></div></label></div>');function l(){$("#"+a).prop("checked",n.isOn),d.find("span.on").text(n.onText),d.find("span.off").text(n.offText)}d.prependTo(r),n.isOn=!1,n.rawTargetValue=void 0,this.render=function(e){$(e).append(r).append(o);$('<input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="'+a+'">').prependTo(d).change(function(e){n.isOn=e.target.checked,freeboard.playSound(i.sound),n.dataTargets.target(n.isOn),n.rawTargetValue=n.isOn})},this.onSettingsChanged=function(e){i=e,o.html(_.isUndefined(e.title)?"":e.title),n.onText=e.on_text,n.offText=e.off_text,l()},this.onCalculatedValueChanged=function(e,t){if("target"==e){n.rawTargetValue=t;var a=t;(r=Boolean(a))!=n.isOn&&(n.isOn=r,freeboard.playSound(i.sound))}if("default"==e&&_.isUndefined(n.rawTargetValue)){n.rawTargetValue=t;var r;a=t;(r=Boolean(a))!=n.isOn&&(n.isOn=r),n.dataTargets.target(r)}l()},this.onDispose=function(){},this.getHeight=function(){return 1},this.onSettingsChanged(t)}}(),function(){var e=0;freeboard.addStyle(".textbox","border: 2px solid #3d3d3d;background-color: #222;margin: 10px;"),freeboard.addStyle(".textbox-label","margin-left: 10px; margin-top: 10px; text-transform: capitalize;"),freeboard.addStyle(".myui-textbox-handle","width: 1.5em !important; height: 1.5em !important; border-radius: 50%; top: -.4em !important; margin-left:-1.0em !important;"),freeboard.addStyle(".ui-textbox-range","background: #F90;"),freeboard.loadWidgetPlugin({type_name:"textbox_plugin",display_name:"Text Box",description:"Interactive Textbox Plugin with 2-way data binding.",fill_size:!0,settings:[{name:"title",display_name:"Title",type:"text",default_value:""},{name:"tooltip",display_name:"Tooltip hint",type:"text",default_value:""},{name:"pattern",display_name:"Validation Regex",type:"text",default_value:".*"},{name:"placeholder",display_name:"Placeholder text",type:"calculated",default_value:""},{name:"mode",display_name:"Mode",type:"option",options:[{name:"Real Time",value:"input"},{name:"When element loses focus",value:"change"}]},{name:"target",display_name:"Data target when value changes. ",description:"Value pushed will be the text",type:"target"},{name:"default",display_name:"Default Value",type:"calculated"}],newInstance:function(e,n){n(new t(e))}});var t=function(t){var n=this;n.currentSettings=t;var a="textbox-"+e++,i=$('<div class="textbox-widget textbox-label" id="__'+a+'"></div>'),r=$('<h2 class="section-title textbox-label"></h2>'),o=$("<input/>",{type:"text",pattern:t.pattern,id:a,name:a}).css("width","90%"),d="#"+a,l="#value-"+a;r.html(n.currentSettings.title),n.value=void 0;n.render=function(e){$(e).append(i),r.appendTo(i),o.appendTo(i),$(d).attr("placeholder",n.currentSettings.placeholder),$(d).attr("title",n.currentSettings.tooltip),$(d).attr("pattern",n.currentSettings.pattern),$(l).html((n.value||"")+n.currentSettings.unit),$(d).on("change",async function(e){_.isUndefined(n.currentSettings.target);try{await n.dataTargets.target(e.target.value)}catch(e){freeboard.showDialog(e,"Bad data target","OK"),freeboard.playSound("error")}}),$(d).on("input",function(e){n.value=e.target.value,$(l).html(e.target.value+n.currentSettings.unit),"change"!=n.currentSettings.mode&&(_.isUndefined(n.currentSettings.target)||n.dataTargets.target(e.target.value))}),$(d).removeClass("ui-widget-content")},n.getHeight=function(){return"big"==n.currentSettings.size?2:1},n.onSettingsChanged=function(e){n.currentSettings=e,r.html(_.isUndefined(e.title)?"":e.title),n.currentSettings.unit=n.currentSettings.unit||"",$(d).attr("pattern",e.pattern),$(d).attr("placeholder",e.placeholder),$(d).attr("tooltip",e.placeholder)},n.onCalculatedValueChanged=function(e,t){var a;"target"==e&&(n.value=t,(a=t)!=$(d).val()&&$(d).val(a));"default"==e&&(_.isUndefined(n.value)&&(n.value=t,(a=t)!=$(d).val()&&$(d).val(a),n.dataTargets.target(t)));"placeholder"==e&&$(d).attr("placeholder",t)},n.onDispose=function(){}}}();